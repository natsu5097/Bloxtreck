<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé≤ Drop Rate Simulator - Blox Fruits Wiki</title>
  <link rel="stylesheet" href="../../style.css">
  <link rel="stylesheet" href="../../assets/styles/tools.css">
  <link rel="icon" href="../../assets/images/sitelogo/bloxtrex.png" type="image/png">
  <style>
    .simulator-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    .simulator-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .simulator-panel {
      background: var(--bg-color-alt);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
    }
    .panel-header {
      font-size: 1.2rem;
      font-weight: var(--font-bold);
      color: var(--primary-color);
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: var(--font-semibold);
      color: var(--text-color);
    }
    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background: var(--bg-color);
      color: var(--text-color);
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.1);
    }
    .boss-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .boss-option {
      background: var(--bg-color);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .boss-option:hover {
      border-color: var(--primary-color);
      transform: translateY(-2px);
    }
    .boss-option.selected {
      border-color: var(--primary-color);
      background: rgba(var(--primary-color-rgb), 0.1);
    }
    .boss-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    .boss-name {
      font-weight: var(--font-semibold);
      color: var(--text-color);
      margin-bottom: 0.25rem;
    }
    .boss-difficulty {
      font-size: 0.8rem;
      color: var(--text-color-muted);
    }
    .simulate-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 8px;
      font-weight: var(--font-bold);
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-bottom: 1rem;
    }
    .simulate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(var(--primary-color-rgb), 0.3);
    }
    .simulate-btn:disabled {
      background: var(--border-color);
      cursor: not-allowed;
      transform: none;
    }
    .results-section {
      grid-column: 1 / -1;
    }
    .simulation-progress {
      background: var(--bg-color);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .progress-bar {
      width: 100%;
      height: 20px;
      background: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }
    .progress-fill {
      height: 100%;
      background: var(--gradient-primary);
      border-radius: 10px;
      transition: width 0.3s ease;
      position: relative;
    }
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .progress-text {
      text-align: center;
      font-weight: var(--font-semibold);
      color: var(--text-color);
    }
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .result-card {
      background: var(--bg-color);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    .result-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--card-shadow-hover);
    }
    .result-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    .result-title {
      font-weight: var(--font-bold);
      color: var(--text-color);
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .result-value {
      font-size: 2rem;
      font-weight: var(--font-bold);
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }
    .result-percentage {
      font-size: 0.9rem;
      color: var(--text-color-muted);
    }
    .drops-list {
      background: var(--bg-color-alt);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      padding: 1.5rem;
    }
    .drop-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--bg-color);
      border-radius: 8px;
      margin-bottom: 0.5rem;
      border-left: 4px solid var(--border-color);
    }
    .drop-item.obtained {
      border-left-color: var(--success-color);
      background: rgba(var(--success-color), 0.1);
    }
    .drop-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .drop-icon {
      font-size: 1.5rem;
    }
    .drop-name {
      font-weight: var(--font-semibold);
      color: var(--text-color);
      margin-bottom: 0.25rem;
    }
    .drop-rate {
      font-size: 0.8rem;
      color: var(--text-color-muted);
    }
    .drop-count {
      font-weight: var(--font-bold);
      color: var(--primary-color);
      font-size: 1.1rem;
    }
    .luck-meter {
      background: var(--bg-color-alt);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      padding: 1.5rem;
      text-align: center;
      margin-bottom: 2rem;
    }
    .luck-display {
      font-size: 3rem;
      font-weight: var(--font-bold);
      margin-bottom: 1rem;
    }
    .luck-display.very-unlucky {
      color: var(--danger-color);
    }
    .luck-display.unlucky {
      color: var(--warning-color);
    }
    .luck-display.average {
      color: var(--text-color);
    }
    .luck-display.lucky {
      color: var(--accent-color);
    }
    .luck-display.very-lucky {
      color: var(--success-color);
    }
    .luck-description {
      font-size: 1.1rem;
      color: var(--text-color-muted);
      margin-bottom: 0.5rem;
    }
    .controls-panel {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .control-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-weight: var(--font-semibold);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .control-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(var(--primary-color-rgb), 0.3);
    }
    .control-btn.secondary {
      background: var(--bg-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    .statistics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .stat-card {
      background: var(--bg-color);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: var(--font-bold);
      color: var(--primary-color);
      margin-bottom: 0.25rem;
    }
    .stat-label {
      font-size: 0.9rem;
      color: var(--text-color-muted);
    }
    @media (max-width: 768px) {
      .simulator-container {
        padding: 1rem;
      }
      .simulator-layout {
        grid-template-columns: 1fr;
      }
      .boss-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }
    }
  </style>
</head>
<body>
  <main>
    <section class="intro">
      <h2>üé≤ Drop Rate Simulator</h2>
      <p>Test your luck with boss drops and rare items! Simulate boss fights and see what drops you might get based on real drop rates.</p>
      <p><a href="../tools.html">‚Üê Back to Tools</a></p>
    </section>

    <div class="simulator-container">
      <div class="simulator-layout">
        <!-- Boss Selection Panel -->
        <div class="simulator-panel">
          <div class="panel-header">
            üëæ Select Boss
          </div>
          
          <div class="boss-grid" id="bossGrid">
            <!-- Bosses will be populated by JavaScript -->
          </div>
        </div>

        <!-- Simulation Settings Panel -->
        <div class="simulator-panel">
          <div class="panel-header">
            ‚öôÔ∏è Simulation Settings
          </div>
          
          <div class="form-group">
            <label class="form-label" for="killCount">Number of Kills</label>
            <input type="number" id="killCount" class="form-control" min="1" max="10000" value="100">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="simulationSpeed">Simulation Speed</label>
            <select id="simulationSpeed" class="form-control">
              <option value="50">Fast (50ms)</option>
              <option value="100" selected>Normal (100ms)</option>
              <option value="200">Slow (200ms)</option>
              <option value="0">Instant</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="luckBoost">Luck Boost</label>
            <select id="luckBoost" class="form-control">
              <option value="1">None (1x)</option>
              <option value="1.5">Premium (1.5x)</option>
              <option value="2">Double Drop Event (2x)</option>
              <option value="2.5">Premium + Event (2.5x)</option>
            </select>
          </div>
          
          <button id="simulateBtn" class="simulate-btn" onclick="startSimulation()">
            Start Simulation
          </button>
          
          <div class="controls-panel">
            <button class="control-btn" onclick="resetSimulation()">Reset</button>
            <button class="control-btn secondary" onclick="exportResults()">Export Results</button>
          </div>
        </div>
      </div>

      <!-- Simulation Progress -->
      <div id="progressSection" class="simulation-progress" style="display: none;">
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
        </div>
        <div id="progressText" class="progress-text">Starting simulation...</div>
      </div>

      <!-- Results Section -->
      <div id="resultsSection" class="results-section" style="display: none;">
        <div class="panel-header">
          üìà Simulation Results
        </div>
        
        <!-- Luck Meter -->
        <div id="luckMeter" class="luck-meter">
          <div id="luckDisplay" class="luck-display average">üé≤</div>
          <div id="luckDescription" class="luck-description">Calculating your luck...</div>
        </div>
        
        <!-- Quick Stats -->
        <div id="resultsGrid" class="results-grid">
          <!-- Results will be populated by JavaScript -->
        </div>
        
        <!-- Detailed Statistics -->
        <div class="statistics-grid" id="statisticsGrid">
          <!-- Statistics will be populated by JavaScript -->
        </div>
        
        <!-- Drops List -->
        <div class="drops-list">
          <div class="panel-header">
            üéÅ Detailed Drop Results
          </div>
          <div id="dropsList">
            <!-- Drops will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Boss data with drop rates
    const bossData = {
      gorilla_king: {
        name: "Gorilla King",
        icon: "ü¶ç",
        difficulty: "First Sea",
        drops: [
          { name: "Pink Coat", rate: 0.05, icon: "üß•" },
          { name: "Gorilla King Crown", rate: 0.02, icon: "üëë" },
          { name: "Money", rate: 1.0, icon: "üí∞", minAmount: 5000, maxAmount: 15000 }
        ]
      },
      vice_admiral: {
        name: "Vice Admiral",
        icon: "üëÆ",
        difficulty: "First Sea",
        drops: [
          { name: "Coat", rate: 0.1, icon: "üß•" },
          { name: "Vice Admiral Coat", rate: 0.03, icon: "üß•" },
          { name: "Money", rate: 1.0, icon: "üí∞", minAmount: 8000, maxAmount: 25000 }
        ]
      },
      swan: {
        name: "Swan",
        icon: "ü¶¢",
        difficulty: "Second Sea",
        drops: [
          { name: "Swan Outfit", rate: 0.05, icon: "üß•" },
          { name: "Swan Glasses", rate: 0.025, icon: "üï∂Ô∏è" },
          { name: "Money", rate: 1.0, icon: "üí∞", minAmount: 15000, maxAmount: 40000 }
        ]
      },
      rip_indra: {
        name: "Rip_Indra",
        icon: "üíÄ",
        difficulty: "Third Sea",
        drops: [
          { name: "Red Spikey Coat", rate: 0.025, icon: "üß•" },
          { name: "Rip_Indra Outfit", rate: 0.02, icon: "üß•" },
          { name: "Dark Blade", rate: 0.005, icon: "üó°Ô∏è" },
          { name: "Money", rate: 1.0, icon: "üí∞", minAmount: 50000, maxAmount: 150000 }
        ]
      },
      dough_king: {
        name: "Dough King",
        icon: "üçû",
        difficulty: "Third Sea",
        drops: [
          { name: "Dough Crown", rate: 0.03, icon: "üëë" },
          { name: "Dough Trident", rate: 0.015, icon: "üî±" },
          { name: "Mirror Fractal", rate: 0.1, icon: "üîÆ" },
          { name: "Money", rate: 1.0, icon: "üí∞", minAmount: 75000, maxAmount: 200000 }
        ]
      },
      cake_prince: {
        name: "Cake Prince",
        icon: "üéÇ",
        difficulty: "Third Sea",
        drops: [
          { name: "Cake Chalice", rate: 0.01, icon: "üèÜ" },
          { name: "Buddy Sword", rate: 0.02, icon: "üó°Ô∏è" },
          { name: "Money", rate: 1.0, icon: "üí∞", minAmount: 40000, maxAmount: 100000 }
        ]
      }
    };

    let selectedBoss = null;
    let simulationData = null;
    let isSimulating = false;

    function initializeSimulator() {
      renderBossGrid();
    }

    function renderBossGrid() {
      const grid = document.getElementById('bossGrid');
      grid.innerHTML = Object.keys(bossData).map(bossKey => {
        const boss = bossData[bossKey];
        return `
          <div class="boss-option" data-boss="${bossKey}" onclick="selectBoss('${bossKey}')">
            <div class="boss-icon">${boss.icon}</div>
            <div class="boss-name">${boss.name}</div>
            <div class="boss-difficulty">${boss.difficulty}</div>
          </div>
        `;
      }).join('');
    }

    function selectBoss(bossKey) {
      selectedBoss = bossKey;
      
      // Update visual selection
      document.querySelectorAll('.boss-option').forEach(option => {
        option.classList.remove('selected');
      });
      document.querySelector(`[data-boss="${bossKey}"]`).classList.add('selected');
    }

    async function startSimulation() {
      if (!selectedBoss) {
        alert('Please select a boss first!');
        return;
      }
      
      if (isSimulating) return;
      
      const killCount = parseInt(document.getElementById('killCount').value);
      const speed = parseInt(document.getElementById('simulationSpeed').value);
      const luckBoost = parseFloat(document.getElementById('luckBoost').value);
      
      if (killCount <= 0 || killCount > 10000) {
        alert('Please enter a valid number of kills (1-10000)!');
        return;
      }
      
      isSimulating = true;
      document.getElementById('simulateBtn').disabled = true;
      document.getElementById('progressSection').style.display = 'block';
      document.getElementById('resultsSection').style.display = 'none';
      
      // Initialize simulation data
      const boss = bossData[selectedBoss];
      simulationData = {
        boss: selectedBoss,
        killCount: killCount,
        luckBoost: luckBoost,
        results: {},
        totalValue: 0
      };
      
      // Initialize results for each drop
      boss.drops.forEach(drop => {
        simulationData.results[drop.name] = {
          count: 0,
          rate: drop.rate,
          icon: drop.icon,
          totalValue: 0
        };
      });
      
      // Run simulation
      if (speed === 0) {
        // Instant simulation
        for (let i = 0; i < killCount; i++) {
          simulateKill(boss, luckBoost);
        }
        completeSimulation();
      } else {
        // Animated simulation
        let currentKill = 0;
        const interval = setInterval(() => {
          simulateKill(boss, luckBoost);
          currentKill++;
          
          updateProgress(currentKill, killCount);
          
          if (currentKill >= killCount) {
            clearInterval(interval);
            completeSimulation();
          }
        }, speed);
      }
    }

    function simulateKill(boss, luckBoost) {
      boss.drops.forEach(drop => {
        const adjustedRate = Math.min(1, drop.rate * luckBoost);
        
        if (Math.random() < adjustedRate) {
          simulationData.results[drop.name].count++;
          
          // Calculate value for money drops
          if (drop.minAmount && drop.maxAmount) {
            const amount = Math.floor(Math.random() * (drop.maxAmount - drop.minAmount + 1)) + drop.minAmount;
            simulationData.results[drop.name].totalValue += amount;
          }
        }
      });
    }

    function updateProgress(current, total) {
      const percentage = (current / total) * 100;
      document.getElementById('progressFill').style.width = percentage + '%';
      document.getElementById('progressText').textContent = `Simulating... ${current}/${total} kills (${percentage.toFixed(1)}%)`;
    }

    function completeSimulation() {
      isSimulating = false;
      document.getElementById('simulateBtn').disabled = false;
      document.getElementById('progressSection').style.display = 'none';
      document.getElementById('resultsSection').style.display = 'block';
      
      displayResults();
    }

    function displayResults() {
      displayLuckMeter();
      displayQuickStats();
      displayDetailedStats();
      displayDropsList();
    }

    function displayLuckMeter() {
      const luckScore = calculateLuckScore();
      const luckDisplay = document.getElementById('luckDisplay');
      const luckDescription = document.getElementById('luckDescription');
      
      // Remove all luck classes
      luckDisplay.className = 'luck-display';
      
      let luckText, luckClass, luckEmoji;
      
      if (luckScore < 0.5) {
        luckClass = 'very-unlucky';
        luckText = 'Very Unlucky';
        luckEmoji = 'üò≠';
      } else if (luckScore < 0.8) {
        luckClass = 'unlucky';
        luckText = 'Unlucky';
        luckEmoji = 'üòî';
      } else if (luckScore < 1.2) {
        luckClass = 'average';
        luckText = 'Average';
        luckEmoji = 'üòê';
      } else if (luckScore < 1.8) {
        luckClass = 'lucky';
        luckText = 'Lucky';
        luckEmoji = 'üôÇ';
      } else {
        luckClass = 'very-lucky';
        luckText = 'Very Lucky';
        luckEmoji = 'ü§©';
      }
      
      luckDisplay.className = `luck-display ${luckClass}`;
      luckDisplay.textContent = luckEmoji;
      luckDescription.textContent = `${luckText} (${(luckScore * 100).toFixed(1)}% of expected drops)`;
    }

    function calculateLuckScore() {
      let expectedDrops = 0;
      let actualDrops = 0;
      
      const boss = bossData[simulationData.boss];
      boss.drops.forEach(drop => {
        if (drop.name !== 'Money') { // Exclude money from luck calculation
          const expected = drop.rate * simulationData.luckBoost * simulationData.killCount;
          const actual = simulationData.results[drop.name].count;
          
          expectedDrops += expected;
          actualDrops += actual;
        }
      });
      
      return expectedDrops > 0 ? actualDrops / expectedDrops : 1;
    }

    function displayQuickStats() {
      const grid = document.getElementById('resultsGrid');
      
      const totalRareDrops = Object.values(simulationData.results)
        .filter(result => result.rate < 0.5) // Consider drops with <50% rate as "rare"
        .reduce((sum, result) => sum + result.count, 0);
      
      const moneyEarned = simulationData.results['Money'] ? simulationData.results['Money'].totalValue : 0;
      const totalKills = simulationData.killCount;
      const bestDrop = getBestDrop();
      
      grid.innerHTML = `
        <div class="result-card">
          <div class="result-icon">üéÅ</div>
          <div class="result-title">Rare Drops</div>
          <div class="result-value">${totalRareDrops}</div>
          <div class="result-percentage">From ${totalKills} kills</div>
        </div>
        <div class="result-card">
          <div class="result-icon">üí∞</div>
          <div class="result-title">Money Earned</div>
          <div class="result-value">${moneyEarned.toLocaleString()}</div>
          <div class="result-percentage">Beli total</div>
        </div>
        <div class="result-card">
          <div class="result-icon">üèÜ</div>
          <div class="result-title">Best Drop</div>
          <div class="result-value">${bestDrop.count}</div>
          <div class="result-percentage">${bestDrop.name}</div>
        </div>
        <div class="result-card">
          <div class="result-icon">‚öîÔ∏è</div>
          <div class="result-title">Success Rate</div>
          <div class="result-value">${((totalRareDrops / totalKills) * 100).toFixed(1)}%</div>
          <div class="result-percentage">Rare drops per kill</div>
        </div>
      `;
    }

    function getBestDrop() {
      let bestDrop = { name: 'None', count: 0 };
      
      Object.entries(simulationData.results).forEach(([name, result]) => {
        if (name !== 'Money' && result.count > bestDrop.count) {
          bestDrop = { name, count: result.count };
        }
      });
      
      return bestDrop;
    }

    function displayDetailedStats() {
      const grid = document.getElementById('statisticsGrid');
      
      const avgRarePerKill = Object.values(simulationData.results)
        .filter(result => result.rate < 0.5)
        .reduce((sum, result) => sum + result.count, 0) / simulationData.killCount;
      
      const mostCommonDrop = getMostCommonDrop();
      const rarestDrop = getRarestObtainedDrop();
      const luckScore = calculateLuckScore();
      
      grid.innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${avgRarePerKill.toFixed(2)}</div>
          <div class="stat-label">Avg Rare/Kill</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${mostCommonDrop.name}</div>
          <div class="stat-label">Most Common (${mostCommonDrop.count})</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${rarestDrop.name}</div>
          <div class="stat-label">Rarest Obtained (${(rarestDrop.rate * 100).toFixed(1)}%)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${(luckScore * 100).toFixed(0)}%</div>
          <div class="stat-label">Luck Score</div>
        </div>
      `;
    }

    function getMostCommonDrop() {
      let mostCommon = { name: 'None', count: 0 };
      
      Object.entries(simulationData.results).forEach(([name, result]) => {
        if (name !== 'Money' && result.count > mostCommon.count) {
          mostCommon = { name, count: result.count };
        }
      });
      
      return mostCommon;
    }

    function getRarestObtainedDrop() {
      let rarest = { name: 'None', rate: 1 };
      
      Object.entries(simulationData.results).forEach(([name, result]) => {
        if (name !== 'Money' && result.count > 0 && result.rate < rarest.rate) {
          rarest = { name, rate: result.rate };
        }
      });
      
      return rarest;
    }

    function displayDropsList() {
      const list = document.getElementById('dropsList');
      
      list.innerHTML = Object.entries(simulationData.results).map(([name, result]) => {
        const obtained = result.count > 0;
        const expectedCount = (result.rate * simulationData.luckBoost * simulationData.killCount).toFixed(1);
        
        let displayValue = result.count.toString();
        if (result.totalValue > 0) {
          displayValue += ` (${result.totalValue.toLocaleString()} Beli)`;
        }
        
        return `
          <div class="drop-item ${obtained ? 'obtained' : ''}">
            <div class="drop-info">
              <div class="drop-icon">${result.icon}</div>
              <div>
                <div class="drop-name">${name}</div>
                <div class="drop-rate">${(result.rate * 100).toFixed(2)}% rate (Expected: ${expectedCount})</div>
              </div>
            </div>
            <div class="drop-count">${displayValue}</div>
          </div>
        `;
      }).join('');
    }

    function resetSimulation() {
      if (isSimulating) return;
      
      simulationData = null;
      document.getElementById('resultsSection').style.display = 'none';
      document.getElementById('progressSection').style.display = 'none';
    }

    function exportResults() {
      if (!simulationData) {
        alert('No simulation results to export!');
        return;
      }
      
      const boss = bossData[simulationData.boss];
      const resultsText = `Blox Fruits Drop Simulation Results\n` +
        `==========================================\n` +
        `Boss: ${boss.name}\n` +
        `Kills: ${simulationData.killCount}\n` +
        `Luck Boost: ${simulationData.luckBoost}x\n\n` +
        `Drops Obtained:\n` +
        Object.entries(simulationData.results).map(([name, result]) => {
          let line = `${name}: ${result.count}`;
          if (result.totalValue > 0) {
            line += ` (${result.totalValue.toLocaleString()} Beli)`;
          }
          const expectedCount = (result.rate * simulationData.luckBoost * simulationData.killCount).toFixed(1);
          line += ` - Expected: ${expectedCount}`;
          return line;
        }).join('\n') +
        `\n\nLuck Score: ${(calculateLuckScore() * 100).toFixed(1)}%`;
      
      // Create downloadable file
      const blob = new Blob([resultsText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `blox_fruits_simulation_${boss.name.toLowerCase().replace(/\s+/g, '_')}_${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initializeSimulator();
    });
  </script>
  <script src="../../script.js"></script>
</body>
</html>



